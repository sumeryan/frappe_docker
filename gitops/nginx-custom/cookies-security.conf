# # Configuração principal para cookies seguros
# location / {
#     proxy_pass http://backend:8000;
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_set_header X-Forwarded-Host $host;
#     proxy_set_header X-Forwarded-Port $server_port;
    
#     # CRÍTICO: Configuração de cookies seguros
#     proxy_cookie_flags ~ HttpOnly Secure SameSite=Strict;
    
#     # Headers de segurança
#     proxy_hide_header X-Powered-By;
#     proxy_hide_header Server;
# }

# # WebSocket com cookies seguros
# location /socket.io/ {
#     proxy_pass http://websocket:9000;
#     proxy_http_version 1.1;
#     proxy_set_header Upgrade $http_upgrade;
#     proxy_set_header Connection "upgrade";
#     proxy_set_header Host $host;
#     proxy_set_header X-Real-IP $remote_addr;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
    
#     # Cookies seguros para WebSocket
#     proxy_cookie_flags ~ HttpOnly Secure SameSite=Strict;
# }

# Configuração principal com MIME types corretos
location / {
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    
    # Cookies seguros
    proxy_cookie_flags ~ HttpOnly Secure SameSite=Strict;
    
    # Headers de segurança
    proxy_hide_header X-Powered-By;
    proxy_hide_header Server;
}

# Configuração específica para assets com MIME types corretos
location /assets/ {
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Cache para assets
    expires 1y;
    add_header Cache-Control "public, immutable";
    
    # MIME types corretos para assets
    location ~* \.(js)$ {
        add_header Content-Type application/javascript;
        proxy_pass http://backend:8000;
    }
    
    location ~* \.(css)$ {
        add_header Content-Type text/css;
        proxy_pass http://backend:8000;
    }
    
    location ~* \.(svg)$ {
        add_header Content-Type image/svg+xml;
        proxy_pass http://backend:8000;
    }
    
    location ~* \.(png|jpg|jpeg|gif|ico|webp)$ {
        add_header Content-Type image/$1;
        proxy_pass http://backend:8000;
    }
}

# WebSocket com cookies seguros
location /socket.io/ {
    proxy_pass http://websocket:9000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    proxy_cookie_flags ~ HttpOnly Secure SameSite=Strict;
}

# Configurações para arquivos específicos do Frappe
location /api/ {
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # Cookies seguros para API
    proxy_cookie_flags ~ HttpOnly Secure SameSite=Strict;
}